---
title: jvm-类加载
date: 2019-08-04 00:57:25
tags: Java
category: Java
---

![photo by https://unsplash.com/photos/ISVm7Rzhy8s](jvm-类加载机制/load-class.png)

关于 JVM 涉及的知识比较深，并且比较难理解。每次看到不懂的地方，我习惯了解之后记下来。相信了解多了也就会变成自己的知识了。今天周六，准备换地方和朋友一起合租住，想想还是美滋滋。

<!--more-->

#### 类生命周期

一个静态的类从被加载到内存，变成动态类，在到被卸载为止，它的生命周期是：
```java

加载--> 链接--> 初始化--> 使用--> 卸载

链接包含：
验证--> 准备--> 解析
```
类的加载必须按照这个过程来加载，除了解析阶段，有可能发生在初始化阶段之后。

#### 类加载器
JDK 包含类 3 中类加载器。分别是 BootStrap ClassLoader 启动类加载器，Extension ClassLoader 扩展类加载器和 Application ClassLoader 应用程序类加载器，启动类类加载器是用 C++ 实现的，作为 JVM 的一部分，而其他类加载器是用 Java 来实现的，都继承自 java.lang.ClassLoader。

##### 双亲委任

###### 类加载器层级

自定义类加载器 > 应用程序类加载器 > 扩展类加载器 > 启动类加载器

除了启动类加载器之外，每个类都有父类加载器。

双亲委任大致可以理解为：当一个加载器加载一个类时，首先交给它的父类加载器加载此类路径下的类，如果父类找不到，在交给它自己的父类进行加载，如果找到了，则加载此类，如果没有找到，则会告知子类信息，子类才会尝试自己加载。也就是说，如果想自己写一个 `java.lang.String` 类来代替 jdk 本身的 `String` 类是不可以的，就算自己写了类加载器也是不能被加载成功的。


##### 运行时数据区

简单来说，运行时数据区就是 Java 程序运行时的数据在内存中的存放空间。主要包含 方法区、堆、虚拟机栈、本地方法栈、程序计数器。

其中方法区和堆是所有线程共享的，而虚拟机栈、本地方法栈和程序计数器是线程私有的。

###### 方法区

 `.java` 文件被编译为  `.class` 文件后，被类加载器加载到内存需要存放到一个内存区域，这个区域就是方法区，方法区主要存放一些不经常改变的数据，常量，静态变量等都存放在这个区域。就像数据表的建表语句，规定了这张表就应该有哪些属性，这些属性应该是什么类型。当我们 new 一个对象时，就像给这张表添加一条数据，内容可以不一样，当时必须要遵循这些属性的格式。当方法区没有足够的空间时会抛 OutOfMemoryError 异常。


 ###### 堆







